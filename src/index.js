window.cssDefaults = {
    // **Positioning**
    position: 'static',
    zIndex: 'auto',
    top: 'auto',
    right: 'auto',
    bottom: 'auto',
    left: 'auto',

    // **Display & Box Model**
    display: 'inline',
    float: 'none',
    clear: 'none',
    overflow: 'visible',
    overflowX: 'visible',
    overflowY: 'visible',
    boxSizing: 'content-box',

    // **Dimensions**
    width: 'auto',
    height: 'auto',
    maxWidth: 'none',
    maxHeight: 'none',
    inlineSize: 'auto',
    blockSize: 'auto',
    minInlineSize: '0',
    minBlockSize: '0',
    maxInlineSize: 'none',
    maxBlockSize: 'none',
    aspectRatio: 'auto',

    // **Borders**
    border: 'none',
    borderWidth: 'medium',
    borderStyle: 'none',
    borderColor: 'currentcolor',
    borderTop: 'none',
    borderRight: 'none',
    borderBottom: 'none',
    borderLeft: 'none',
    borderTopWidth: '0px',
    borderRightWidth: '0px',
    borderBottomWidth: '0px',
    borderLeftWidth: '0px',
    borderRadius: '0',
    borderTopLeftRadius: '0',
    borderTopRightRadius: '0',
    borderBottomRightRadius: '0',
    borderBottomLeftRadius: '0',
    borderCollapse: 'separate',
    borderImageSource: 'none',
    borderImageSlice: '100%',
    borderImageWidth: '1',
    borderImageOutset: '0',
    borderImageRepeat: 'stretch',
    borderBlockStartColor: 'currentcolor',
    borderBlockStartStyle: 'none',
    borderBlockStartWidth: 'medium',
    borderBlockEndColor: 'currentcolor',
    borderBlockEndStyle: 'none',
    borderBlockEndWidth: 'medium',
    borderInlineStartColor: 'currentcolor',
    borderInlineStartStyle: 'none',
    borderInlineStartWidth: 'medium',
    borderInlineEndColor: 'currentcolor',
    borderInlineEndStyle: 'none',
    borderInlineEndWidth: 'medium',

    // **Background**
    background: 'transparent',
    backgroundColor: 'transparent',
    backgroundImage: 'none',
    backgroundRepeat: 'repeat',
    backgroundAttachment: 'scroll',
    backgroundPositionX: '0%',
    backgroundPositionY: '0%',
    backgroundPosition: '0% 0%',
    backgroundSize: 'auto',
    backgroundBlendMode: 'normal',
    backgroundClip: 'border-box',
    backgroundOrigin: 'padding-box',

    // **Typography**
    fontFamily: 'serif',
    fontStyle: 'normal',
    fontVariant: 'normal',
    fontStretch: 'normal',
    fontSizeAdjust: 'none',
    fontFeatureSettings: 'normal',
    fontKerning: 'auto',
    fontLanguageOverride: 'normal',
    fontOpticalSizing: 'auto',
    fontPalette: 'normal',
    fontSynthesis: 'weight style small-caps',
    fontSynthesisSmallCaps: 'auto',
    fontSynthesisStyle: 'auto',
    fontSynthesisWeight: 'auto',
    fontVariantAlternates: 'normal',
    fontVariantCaps: 'normal',
    fontVariantEastAsian: 'normal',
    fontVariantLigatures: 'normal',
    fontVariantNumeric: 'normal',
    fontVariantPosition: 'normal',
    fontVariationSettings: 'normal',
    lineHeight: 'normal',
    letterSpacing: 'normal',
    textAlign: 'start',
    textAlignLast: 'auto',
    textDecoration: 'none',
    textDecorationColor: 'currentcolor',
    textDecorationLine: 'none',
    textDecorationStyle: 'solid',
    textDecorationThickness: 'auto',
    textUnderlineOffset: 'auto',
    textUnderlinePosition: 'auto',
    textTransform: 'none',
    textOverflow: 'clip',
    textRendering: 'auto',
    whiteSpace: 'normal',
    wordSpacing: 'normal',
    wordBreak: 'normal',
    hyphens: 'manual',
    tabSize: '8',
    writingMode: 'horizontal-tb',
    direction: 'ltr',
    color: 'initial',

    // **Flexbox & Grid**
    flexDirection: 'row',
    flexWrap: 'nowrap',
    justifyContent: 'flex-start',
    alignItems: 'stretch',
    alignContent: 'normal',
    order: '0',
    flexGrow: '0',
    flexShrink: '1',
    flexBasis: 'auto',
    alignSelf: 'auto',
    justifyItems: 'legacy',
    justifySelf: 'auto',
    gridTemplateColumns: 'none',
    gridTemplateRows: 'none',
    gridTemplateAreas: 'none',
    gridAutoColumns: 'auto',
    gridAutoRows: 'auto',
    gridAutoFlow: 'row',
    gridColumnStart: 'auto',
    gridColumnEnd: 'auto',
    gridRowStart: 'auto',
    gridRowEnd: 'auto',
    rowGap: 'normal',
    columnGap: 'normal',

    // **List Properties**
    listStyleType: 'disc',
    listStylePosition: 'outside',
    listStyleImage: 'none',

    // **Tables**
    tableLayout: 'auto',
    captionSide: 'top',
    emptyCells: 'show',

    // **Transforms & Transitions**
    transform: 'none',
    transformOrigin: '50% 50% 0',
    transformStyle: 'flat',
    perspective: 'none',
    perspectiveOrigin: '50% 50%',
    backfaceVisibility: 'visible',
    transitionProperty: 'all',
    transitionDuration: '0s',
    transitionTimingFunction: 'ease',
    transitionDelay: '0s',
    rotate: 'none',
    scale: 'none',
    translate: 'none',
    offsetPath: 'none',
    offsetRotate: 'auto',
    offsetAnchor: 'auto',

    // **Miscellaneous**
    opacity: '1',
    visibility: 'visible',
    cursor: 'auto',
    content: 'normal',
    quotes: 'auto',
    boxShadow: 'none',
    outline: 'none',
    outlineColor: 'currentcolor',
    outlineStyle: 'none',
    outlineWidth: 'medium',
    overflowWrap: 'normal',
    overflowAnchor: 'auto',
    overscrollBehavior: 'auto',
    overscrollBehaviorX: 'auto',
    overscrollBehaviorY: 'auto',
    isolation: 'auto',
    mixBlendMode: 'normal',
    filter: 'none',
    backdropFilter: 'none',
    willChange: 'auto',
    userSelect: 'auto',
    pointerEvents: 'auto',
    touchAction: 'auto',
    resize: 'none',
    scrollBehavior: 'auto',
    scrollSnapType: 'none',
    scrollSnapAlign: 'none',
    scrollSnapStop: 'normal',
    scrollPadding: '0',
    scrollMargin: '0',
    clip: 'auto',
    clipPath: 'none',
    caretColor: 'auto',
    colorScheme: 'normal',
    accentColor: 'auto',
    contain: 'none',
    contentVisibility: 'visible',
    counterSet: 'none',
    forcedColorAdjust: 'auto',
    hyphenateCharacter: 'auto',
    imageOrientation: 'from-image',
    imageRendering: 'auto',
    lineBreak: 'auto',
    mathDepth: '0',
    mathStyle: 'normal',
    printColorAdjust: 'economy',
    scrollPaddingBlockEnd: 'auto',
    scrollPaddingBlockStart: 'auto',
    scrollPaddingInlineEnd: 'auto',
    scrollPaddingInlineStart: 'auto',
    scrollbarColor: 'auto',
    scrollbarGutter: 'auto',
    scrollbarWidth: 'auto',
    shapeImageThreshold: '0',
    shapeOutside: 'none',
    textEmphasisColor: 'currentcolor',
    textEmphasisStyle: 'none',
    whiteSpaceCollapse: 'collapse',
    zoom: '1',

    // **SVG-specific properties**
    fillOpacity: '1',
    fillRule: 'nonzero',
    stroke: 'none',
    strokeOpacity: '1',
    strokeLinecap: 'butt',
    strokeLinejoin: 'miter',
    strokeMiterlimit: '4',
    strokeDasharray: 'none',
    colorInterpolation: 'srgb',
    colorInterpolationFilters: 'linearrgb',
    dominantBaseline: 'auto',
    textAnchor: 'start',
    shapeRendering: 'auto',
    vectorEffect: 'none',
    stopOpacity: '1',

    // **Vendor-specific properties**
    MozAppearance: 'none',
    MozBoxAlign: 'stretch',
    MozBoxDirection: 'normal',
    MozBoxFlex: '0',
    MozBoxOrdinalGroup: '1',
    MozBoxOrient: 'horizontal',
    MozBoxPack: 'start',
    MozFloatEdge: 'content-box',
    MozForceBrokenImageIcon: '0',
    MozOrient: 'inline',
    MozTextSizeAdjust: 'auto',
    MozUserInput: 'auto',
    MozWindowDragging: 'default',
    WebkitAppearance: 'none',
    WebkitLineClamp: 'none',
    WebkitTextFillColor: 'currentcolor',
    WebkitTextSecurity: 'none',
    WebkitTextStrokeColor: 'currentcolor',
    WebkitTextStrokeWidth: '0',

    // **Additional properties from your lists**
    animationComposition: 'replace',
    baselineSource: 'auto',
    mainAxisAlign: 'normal', // Non-standard property
    crossAxisAlign: 'normal', // Non-standard property
    dir: 'ltr',
    // The following properties are non-standard or custom
    roundedBorders: true,
    rx: 'auto',
    ry: 'auto',
    x: '0px',
    y: '0px',
    fill: 'rgb(0, 0, 0)',
    textCombineUpright: 'none',
    textShadow: 'none',
    animationDelay: '0s',
    animationDirection: 'normal',
    animationDuration: '0s',
    animationFillMode: 'none',
    animationIterationCount: '1',
    animationName: 'none',
    animationPlayState: 'running',
    animationTimingFunction: 'ease',
    appearance: 'none',
    borderEndEndRadius: '0px',
    borderEndStartRadius: '0px',
    borderSpacing: '0px 0px',
    borderStartEndRadius: '0px',
    borderStartStartRadius: '0px',
    boxDecorationBreak: 'slice',
    breakAfter: 'auto',
    breakBefore: 'auto',
    breakInside: 'auto',
    clipRule: 'nonzero',
    columnCount: 'auto',
    columnFill: 'balance',
    columnRuleStyle: 'none',
    columnSpan: 'none',
    columnWidth: 'auto',
    containerName: 'none',
    counterIncrement: 'none',
    counterReset: 'none',
    cx: '0px',
    cy: '0px',
    d: 'none',
    floodColor: 'rgb(0, 0, 0)',
    floodOpacity: '1',
    fontSize: '16px',
    fontSynthesisPosition: 'auto',
    fontWeight: '400',
    imeMode: 'auto',
    insetBlockEnd: 'auto',
    insetBlockStart: 'auto',
    insetInlineEnd: 'auto',
    insetInlineStart: 'auto',
    lightingColor: 'rgb(255, 255, 255)',
    marginBlockEnd: '0px',
    marginBlockStart: '0px',
    marginBottom: '0px',
    marginInlineEnd: '0px',
    marginInlineStart: '0px',
    marginLeft: '0px',
    marginRight: '0px',
    marginTop: '0px',
    markerEnd: 'none',
    markerMid: 'none',
    markerStart: 'none',
    maskClip: 'border-box',
    maskComposite: 'add',
    maskImage: 'none',
    maskMode: 'match-source',
    maskOrigin: 'border-box',
    maskPositionX: '0%',
    maskPositionY: '0%',
    maskSize: 'auto',
    maskType: 'luminance',
    minHeight: 'auto',
    minWidth: 'auto',
    objectFit: 'fill',
    objectPosition: '50% 50%',
    offsetDistance: '0px',
    offsetPosition: 'normal',
    outlineOffset: '0px',
    overflowClipMargin: '0px',
    overscrollBehaviorBlock: 'auto',
    overscrollBehaviorInline: 'auto',
    paddingBlockEnd: '0px',
    paddingBlockStart: '0px',
    paddingBottom: '0px',
    paddingInlineEnd: '0px',
    paddingInlineStart: '0px',
    paddingLeft: '0px',
    paddingRight: '0px',
    paddingTop: '0px',
    page: 'auto',
    paintOrder: 'normal',
    r: '0px',
    rubyAlign: 'space-around',
    rubyPosition: 'alternate',
    scrollMarginBlockEnd: '0px',
    scrollMarginBlockStart: '0px',
    scrollMarginBottom: '0px',
    scrollMarginInlineEnd: '0px',
    scrollMarginInlineStart: '0px',
    scrollMarginLeft: '0px',
    scrollMarginRight: '0px',
    scrollMarginTop: '0px',
    shapeMargin: '0px',
    stopColor: 'rgb(0, 0, 0)',
    strokeDashoffset: '0px',
    strokeWidth: '1px',
    textDecorationSkipInk: 'auto',
    textEmphasisPosition: 'auto',
    textIndent: '0px',
    textJustify: 'auto',
    textOrientation: 'mixed',
    textWrapMode: 'wrap',
    textWrapStyle: 'auto',
    transformBox: 'view-box',
    transitionBehavior: 'normal',
    unicodeBidi: 'isolate',
    verticalAlign: 'baseline',
};


window.propsThatNeedStyles = [
    'fill',
    'backgroundPositionX',
    'backgroundPositionY'
];

window.getType = element => {
    if (element.tagName === 'IMG')
        return 'image';
    if (element.tagName === 'INPUT')
        return 'input';
    if (
        (
            element.tagName === 'SPAN' ||
            element.tagName === 'H3' ||
            element.tagName === 'A' ||
            element.tagName === 'LABEL'
        ) &&
        element.childNodes.length === 1 &&
        element.firstChild.nodeType === Node.TEXT_NODE
    )
        return 'label';
    return 'container';
};

window.toCamelCase = str => {
    return str.replace(/-([a-z])/g, (match, letter) => letter.toUpperCase());
};

window.getAllStylesWithoutDefault = element => {
    const computedStyles = window.getComputedStyle(element);
    const result = {};
    for (let i = 0; i < computedStyles.length; i++) {
        const property = computedStyles[i];
        const computedValue = computedStyles.getPropertyValue(property);
        result[property] = computedValue;
    }
    return result;
}

window.directions = [
    'Bottom',
    'Top',
    'Left',
    'Right'
];

window.combineBorderStyles = node => {
    const prps = node.prps;

    window.directions.forEach(d => {
        const prpBorder = `border${d}`;
        const prpBorderWidth = `border${d}Width`;
        const prpBorderColor = `border${d}Color`;
        const prpBorderStyle = `border${d}Style`;

        const valueBorder = `${prps[prpBorderWidth]} ${prps[prpBorderStyle]} ${prps[prpBorderColor]}`;

        if (prps[prpBorderWidth])
            prps[prpBorder] = valueBorder;

        delete prps[prpBorderWidth];
        delete prps[prpBorderColor];
        delete prps[prpBorderStyle];
    });

    if (prps.borderLeft === prps.borderLeft) {}
};

window.recurseBuildElement = element => {
    if (element.nodeType === Node.TEXT_NODE) {
        return {
            type: 'label',
            prps: {
                cpt: element.textContent.trim()
            }
        };
    } else if (
        element.nodeType !== Node.ELEMENT_NODE ||
        element.tagName === 'SCRIPT' ||
        element.tagName === 'NOSCRIPT' ||
        element.tagName === 'STYLE'
    )
        return;

    const prps = {};
    const appliedStyles = window.getAllStylesWithoutDefault(element);

    let addStyles = undefined;
    Object.entries(appliedStyles).forEach(([k, v]) => {
        const camelCaseProp = window.toCamelCase(k);

        if (
            window.cssDefaults[camelCaseProp] === v ||
            camelCaseProp[0] === '-' ||
            camelCaseProp.includes('Moz') ||
            camelCaseProp.includes('Webkit')
        )
            return;

        if (window.propsThatNeedStyles.includes(camelCaseProp)) {
            if (!addStyles)
                addStyles = {};

            addStyles[k] = `${v} !important`;

            return;
        }

        prps[camelCaseProp] = v;
    });

    const type = window.getType(element);
    if (type === 'image' && element.src)
        prps.value = element.src;

    const node = {
        type,
        prps
    };

    if (node.type === 'label' && !node.prps.cpt)
        node.prps.cpt = element.textContent.trim();

    if (node.prps.visibility === 'hidden' || node.prps.display === 'none') {
        delete node.prps.visibility;
        delete node.prps.display;
        node.prps.vis = false;
    }

    if (node.type === 'container') {
        node.prps.dir = node.prps.flexDirection === 'column' ? 'vertical' : 'horizontal';
        delete node.prps.flexDirection;

        if (node.prps.display !== 'flex')
            node.prps.dir = 'vertical';
    }

    if (node.prps.justifyContent) {
        node.prps.mainAxisAlign = node.prps.justifyContent;
        delete node.prps.justifyContent;
    }

    if (node.prps.alignItems) {
        node.prps.crossAxisAlign = node.prps.alignItems;
        delete node.prps.alignItems;
    }

    if (node.prps.borderTopLeftRadius) {
        node.prps.borderRadius = node.prps.borderTopLeftRadius;
        node.prps.roundedBorders = true;
        delete node.prps.borderTopLeftRadius;
        delete node.prps.borderTopRightRadius;
        delete node.prps.borderBottomRightRadius;
        delete node.prps.borderBottomLeftRadius;
    }

    if (node.prps.textAlign) {
        const value = node.prps.textAlign === 'justify' ? 'stretch' : node.prps.textAlign;
        node.prps.justify = value;
        delete node.prps.textAlign;
    }

    window.combineBorderStyles(node);

    if (addStyles !== undefined) {
        node.prps.style = {
            [`.cpn${node.type.charAt(0).toUpperCase()}${node.type.substr(1)}`]: addStyles
        };
    }

    const children = Array.from(element.childNodes).map(child => window.recurseBuildElement(child));
    if (children.length > 0)
        node.wgts = children.filter(c => !!c);

    return node;
};

(() => {
    const modal = document.createElement('div');
    Object.assign(modal.style, {
      position: 'fixed',
      bottom: '20px',
      right: '20px',
      width: '300px',
      backgroundColor: '#ffffff',
      border: '1px solid #cccccc',
      borderRadius: '8px',
      boxShadow: '0 4px 6px rgba(0, 0, 0, 0.1)',
      overflow: 'hidden',
      fontFamily: 'Arial, sans-serif',
      zIndex: '1000',
    });

    const content = document.createElement('div');
    Object.assign(content.style, {
      padding: '20px',
    });

    const progressBarContainer = document.createElement('div');
    Object.assign(progressBarContainer.style, {
      backgroundColor: '#e0e0e0',
      borderRadius: '4px',
      height: '20px',
      overflow: 'hidden',
      marginBottom: '10px',
    });

    const progressBar = document.createElement('div');
    Object.assign(progressBar.style, {
      backgroundColor: '#4caf50',
      height: '100%',
      width: '0%',
      transition: 'width 0.5s linear',
    });

    progressBarContainer.appendChild(progressBar);
    content.appendChild(progressBarContainer);

    const statusText = document.createElement('div');
    Object.assign(statusText.style, {
      fontSize: '14px',
      color: '#333333',
    });
    statusText.textContent = 'Initializing...';

    content.appendChild(statusText);
    modal.appendChild(content);
    document.body.appendChild(modal);

    const phrases = [
      'Analyzing HTML',
      'Parsing Document Structure',
      'Extracting Elements',
      'Optimizing Content',
      'Converting to Opus Format',
      'Applying AI Enhancements',
      'Finalizing Conversion',
      'Completing Process',
      'Almost Done',
      'Conversion Complete',
    ];

    let progress = 0;
    let phraseIndex = 0;

    const interval = setInterval(() => {
      progress += 10;
      progressBar.style.width = progress + '%';

      if (phraseIndex < phrases.length) {
        statusText.textContent = phrases[phraseIndex];
        phraseIndex++;
      }

      if (progress >= 100) {
        clearInterval(interval);
        setTimeout(() => {
          modal.remove();
        }, 1000);
      }
    }, 1000);
  })();

window.result = window.recurseBuildElement($0);
copy(JSON.stringify(window.result, null, '\t'));
console.log('Copied to clipboard');
